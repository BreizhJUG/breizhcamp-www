---

---
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr'" lang="fr-fr" ng-app="MobileProgramme" ng-controller="MobileCtrl">
<head>
    <meta charset="utf-8">
    <meta name="title" content="{{site.title}}">
    <meta itemprop="name" content="{{site.title}}">
    <meta property="og:title" content="{{site.title}}">
    <meta name="description" content="{{site.description}}">
    <meta itemprop="description" content="{{site.description}}">
    <meta id="meta-tag-description" property="og:description" content="{{site.description}}">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>{{site.title}}</title>
    <link rel="shortcut icon" type="image/x-icon" href="{{site.url}}/img/favicon.ico" />
    <link rel="icon" type="image/png" href="{{site.url}}/img/favicon.png"/>
    <link rel="apple-touch-icon" href="{{site.url}}/img/apple-touch-icon.png"/>



    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
    <script src="{{site.url}}/js/jquery-mobile-angular-adapter-standalone.min.js"></script>

{% raw %}
    <script>
        var app = angular.module("MobileProgramme", []);

        function findHoraireByTime(horaires, time) {
            var horaireFound = undefined;
            angular.forEach(horaires, function(horaire) {
                if (horaire.time === time) {
                    horaireFound = horaire;
                }
            });
            return horaireFound;
        }

        function MobileCtrl($scope, $http) {
            $scope.loading = true;

            $http.jsonp("http://cfp.breizhcamp.org/programme/jsonp?callback=JSON_CALLBACK")
                    .success(function(data) {
                        angular.forEach(data.programme.jours, function(jour){

                            jour.countTalks = 0;
                            jour.horaires = [];


                            angular.forEach(jour.tracks, function(track){
                                jour.countTalks += track.talks.length;
                                angular.forEach(track.talks, function(talk){
                                    if (talk.time.length < 5) {
                                        talk.time = '0' + talk.time;
                                    }
                                    talk.track = track.type;

                                    var currentHoraire = findHoraireByTime(jour.horaires, talk.time);

                                    if (currentHoraire === undefined) {
                                        currentHoraire = {
                                            time : talk.time,
                                            talks : []
                                        };
                                        jour.horaires.push(currentHoraire);
                                    }

                                    currentHoraire.talks.push(talk);
                                });
                            });

                            jour.horaires.sort(function (horaire1, horaire2){
                                return horaire1.time.localeCompare(horaire2.time);
                            });
                        });
                        $scope.programme = data.programme;
                        $scope.loading = false;
                    });
        }

        app.directive('horaires', function factory() {
            var directiveDefinitionObject = {
                restrict: 'A',
                replace: true,
                require: 'ngModel',
                transclude: true,
                link: function postLink(scope, iElement, iAttr,ngModel) {

                    scope.$watch(function () {
                        return ngModel.$modelValue;
                    }, function(value) {
                        var output = '';
                        angular.forEach(value, function(horaire){
                            output += '<li data-role="list-divider">';
                            output += horaire.time;
                            output += '</li>';

                            angular.forEach(horaire.talks, function(talk) {
                                output += '<li>';
                                output += talk.title;
                                output += '<span class="ui-li-count">';
                                output += talk.track;
                                output += '</span></li>'
                            });

                        });

                        iElement.html(output);
                    });

                }

            };
            return directiveDefinitionObject;
        });

        app.directive('horaires', function() {
            return function(scope, element, attr, ngModel) {

            }
        });

    </script>
</head>
<body>



<!-- Home -->
<div data-role="page" id="jours" data-theme="d">
    <div data-role="header">
        <h3>
            Breizhcamp 2013
        </h3>
    </div>

    <div data-role=content>
        <h3>Jours de conf√©rences</h3>
        <ul data-role=listview data-inset=true
            id=listjours>
             <li ng-repeat="jour in programme.jours"><a href="#{{jour.title}}">{{jour.date}}</a><span class="ui-li-count">{{jour.countTalks}}</span></li>

        </ul>
    </div>
</div>

<div data-role="page" id="{{jour.title}}" ng-repeat="jour in programme.jours" data-theme="d">
    <div data-role="header">
        <h3>{{jour.title}}</h3>
    </div>

    <div data-role=content>
        <ul data-role=listview data-inset=true horaires ng-model="jour.horaires">
        </ul>

    </div>
</div>


{% endraw %}


</body>


<script src="{{site.url}}/js/Markdown.Converter.js"></script>
<script src="{{site.url}}/js/Markdown.Sanitizer.js"></script>
</html>
